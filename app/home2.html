<!DOCTYPE html>
<html lang="uk" dir="ltr">
<head>
    //= details/head.html
</head>
<body>
//= details/header.html
<main>
    <section class="mosaic" id="mosaic">
        <div id="mosaic-popups" hidden>
            <div class="pop-inf" data-name="some new name">
                <div class="ttl">Customs & revenue authorities</div>
                <div class="txt">

                    <span>Platform that enables compliant trade</span>
                    <div class="t">
                        <p>designed to address the scale, complexity, frequency and speed of regulatory changes, at a
                            time of a decoupling global economy.</p>
                        <p><strong>Enable effective enforcement of trade policies </strong></p>
                    </div>
                    <a href="" class="lnk">Buy product</a>

                </div>
                <img class="im-p" src="./img/cab2.png" alt="">
            </div>
            <div class="pop-inf">
                <div class="ttl">Customs & revenue authorities Customs & revenue authorities</div>
                <div class="txt">

                    <span>Platform that enables compliant trade</span>
                    <div class="t">
                        <p>designed to address the scale, complexity, frequency and speed of regulatory changes, at a
                            time of a decoupling global economy.</p>
                        <p><strong>Enable effective enforcement of trade policies </strong></p>
                    </div>
                    <a href="" class="lnk">Buy product</a>

                </div>
                <img class="im-p" src="./img/cab3.png" alt="">
            </div>
            <div class="pop-inf">
                <div class="ttl">Customs & revenue authorities</div>
                <div class="txt">

                    <span>Platform that enables compliant trade</span>
                    <div class="t">
                        <p>designed to address the scale, complexity, frequency and speed of regulatory changes, at a
                            time of a decoupling global economy.</p>
                        <p><strong>Enable effective enforcement of trade policies </strong></p>
                    </div>
                    <a href="" class="lnk">Buy product</a>

                </div>
                <img class="im-p" src="./img/cab4.png" alt="">
            </div>
            <div class="pop-inf">
                <div class="ttl">Customs & revenue authorities</div>
                <div class="txt">

                    <span>Platform that enables compliant trade</span>
                    <div class="t">
                        <p>designed to address the scale, complexity, frequency and speed of regulatory changes, at a
                            time of a decoupling global economy.</p>
                        <p><strong>Enable effective enforcement of trade policies </strong></p>
                    </div>
                    <a href="" class="lnk">Buy product</a>

                </div>
                <img class="im-p" src="./img/cab10.png" alt="">
            </div>
        </div>

        <div id="mosaic-sources" hidden>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab1.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab2.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab3.png" alt="">
                </div>

                </div>

            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab4.png" alt="">
                </div>

            </div>

            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab5.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab6.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab7.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab8.png" alt="">
                </div>

            </div>

            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab9.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab10.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab11.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab12.png" alt="">
                </div>

            </div>

            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab13.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab14.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab15.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab16.png" alt="">
                </div>

            </div>

            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab17.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab18.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab19.png" alt="">
                </div>

            </div>
            <div class="card-wrap">
                <div class="card" data-name="name" data-link="/">
                    <img src="./img/cab20.png" alt="">
                </div>

            </div>


        </div>


        <div class="mosaic__viewport" id="viewport">
            <div class="mosaic__plane" id="plane">
                <div class="mosaic__content" id="content"></div>
            </div>
        </div>


        <div class="mosaic__flylayer" id="flylayer"></div>


        <aside class="mosaic__panel" id="panel" aria-hidden="true">
            <div class="log">
                <img src="./img/publican.png" alt="">
            </div>
            <button class="mosaic__panel-close" aria-label="Close">✕</button>

            <div class="mosaic__panel-body">
                <div class="mosaic__panel-body-inner">
                    <h3 class="mosaic__panel-title">Customs & revenue authorities
                    </h3>
                    <div class="txt">
                        <span></span>
                    </div>
                    <div class="mosaic__panel-img-wrap">
                        <div class="mosaic__panel-img"><img alt=""></div>
                    </div>
                    <div class="mosaic-panel-bot">
                        <a class="mosaic__panel-cta" target="_blank" rel="noopener"></a>
                    </div>
                </div>


            </div>


        </aside>
        <div class="mosaic__panel-header">
            <div class="burger-btn">
                <div class="brg">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <p>menu</p>
            </div>
            <div class="mosaic__panel-menu">
                <div class="men">
                    <ul class="">
                        <li id="menu-item-25"
                            class="menu-item menu-item-type-post_type menu-item-object-page menu-item-25"><a
                                href="https://publican.ultra.global/solution/">Solutions</a></li>
                        <li id="menu-item-26"
                            class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a
                                href="https://publican.ultra.global/technology/">Technology</a></li>
                        <li id="menu-item-581"
                            class="menu-item menu-item-type-post_type menu-item-object-page menu-item-581"><a
                                href="https://publican.ultra.global/world/">World</a></li>
                        <li id="menu-item-77"
                            class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77"><a
                                href="https://publican.ultra.global/category/case-studies/">Case Studies</a></li>
                        <li id="menu-item-21"
                            class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21"><a
                                href="https://publican.ultra.global/about-us/">About us</a></li>
                        <li id="menu-item-22"
                            class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22"><a
                                href="https://publican.ultra.global/contact-us/">Contact US</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <a href="" class="log-mos"><img src="./img/logultra.png" alt=""></a>
        <div class="mosaic__ui">
            <p>Drag to explore</p>
            <div class="btns">
                <button class="btnk" data-zoom="out" aria-label="Zoom out">−</button>
                <button class="btnk" data-zoom="in" aria-label="Zoom in">+</button>
            </div>

        </div>


        <div class="mosaic__preload">
            <div class="mosaic__preload-cont">
                <div class="log">
                    <img src="./img/preload1.png" alt="">
                </div>
                <div class="txt">
                    <h1 class="ttl">Every package tells a story.</h1>
                    <div class="txt-log">
                        <div class="lg">
                            <img src="./img/publican.png" alt="">
                        </div>
                        <span>makes sure it’s the right one</span>
                    </div>
                    <p>Publican is Ultra’s AI-powered compliance network for global trade. We unify product, partner,
                        and shipment data to verify origin, classification, valuation, safety, and sanctions exposure -
                        before the border. Trusted shipments flow faster; risky ones get targeted. Pre-validate the
                        trusted. Target the risky.</p>
                    <a href="" class="btn-open">Explore</a>
                </div>
            </div>
        </div>
    </section>

</main>


<!--//= details/footer.html-->
//= details/scripts.html
<script>
    var burger = [...document.querySelectorAll('.burger-btn')];
    var header = document.querySelector('.mosaic__panel-header');

    function burgerControl() {
        if (burger.length) {
            burger.forEach((btn) => {
                btn.addEventListener('click', () => {
                    btn.classList.toggle('active');
                    header.classList.toggle('active');
                    document.body.classList.toggle('no-scroll');
                });
            });
        }
    }

    burgerControl();

    (() => {
        const btnOpen = document.querySelector('.btn-open');
        const preloadBlock = document.querySelector('.mosaic__preload');

        const root = document.getElementById('mosaic');
        const view = document.getElementById('viewport');
        const plane = document.getElementById('plane');
        let content = document.getElementById('content');
        if (!content) {
            content = document.createElement('div');
            content.id = 'content';
            content.className = 'mosaic__content';
            while (plane.firstChild) content.appendChild(plane.firstChild);
            plane.appendChild(content);
        }

        /* Params */
        let PER_COL = 9;
        let COLS = 22;
        if (window.innerWidth < 768) {
            PER_COL = 14;
            COLS = 14;
        }
        const ZOOMS = [1.0, 0.5, 0.3]; let zoomIdx = 0;
        const LERP_POS = 0.18, LERP_SCALE = 0.20, INERTIA = 0.98, EPS = 1e-6;

        const PANEL_DUR_MS = 400;
        const REVEAL_ONCE = true;
        const REVEAL_MARGIN_PX = 8;
        const VISIBILITY_CHECK_SKIP = 3;

        const TAP_DIST = 4, TAP_TIME = 300;

        const clamp = (v, min, max) => Math.min(max, Math.max(min, v));

        /* ===== INTRO STATE ===== */
        let introScale = 0.7;      // стартова “віддаленість”
        let isIntro = true;        // поки банер на екрані

        function animateIntroToOne(duration = 700) {
            const start = performance.now();
            const from = introScale;
            const to = 1;
            const ease = (t) => t < .5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2; // easeInOutQuad

            function step(now) {
                const p = clamp((now - start) / duration, 0, 1);
                introScale = from + (to - from) * ease(p);
                if (p < 1) requestAnimationFrame(step);
                else introScale = 1;
            }
            requestAnimationFrame(step);
        }

        /* utils */
        function parseCssMs(s) {
            const first = String(s).split(',')[0].trim();
            if (first.endsWith('ms')) return parseFloat(first);
            if (first.endsWith('s')) return parseFloat(first) * 1000;
            const n = parseFloat(first);
            return isNaN(n) ? PANEL_DUR_MS : n;
        }

        function waitTransition(el, prop = 'transform', fallbackMs = PANEL_DUR_MS + 200) {
            return new Promise(resolve => {
                let done = false;
                const tidy = () => {
                    if (done) return;
                    done = true;
                    el.removeEventListener('transitionend', onEnd);
                    clearTimeout(to);
                    resolve();
                };
                const onEnd = (e) => { if (e.target === el && e.propertyName === prop) tidy(); };
                const dur = parseCssMs(getComputedStyle(el).transitionDuration) + 80;
                const to = setTimeout(tidy, Math.max(dur, fallbackMs));
                el.addEventListener('transitionend', onEnd);
            });
        }

        /* Build grid from mosaic-sources */
        function collectCards() {
            const host = document.getElementById('mosaic-sources');
            return host ? Array.from(host.querySelectorAll('.card')) : [];
        }
        function buildGrid(cards) {
            content.innerHTML = '';
            const n = cards.length; if (!n) return;
            for (let c = 0; c < COLS; c++) {
                const col = document.createElement('div'); col.className = 'col';
                for (let r = 0; r < PER_COL; r++) {
                    const clone = cards[(c * PER_COL + r) % n].cloneNode(true);
                    clone.dataset.number = (c * PER_COL + r) % n;
                    col.appendChild(clone);
                }
                content.appendChild(col);
            }
        }

        /* Collect popup infos from mosaic-popups */
        const popupsHost = document.getElementById('mosaic-popups');
        const popupItems = popupsHost ? Array.from(popupsHost.querySelectorAll('.pop-inf')) : [];
        let popupIndex = 0; // який попап буде наступним

        /* Name bubble (показує назву наступного попапа) */
        const nameBubble = document.createElement('div');
        nameBubble.className = 'mosaic__name';
        document.body.appendChild(nameBubble);

        const showName = (t, x, y) => {
            nameBubble.textContent = t;
            nameBubble.style.left = x + 'px';
            nameBubble.style.top = y + 'px';
            nameBubble.classList.add('_show');
        };
        const hideName = () => nameBubble.classList.remove('_show');

        function getNextPopupName() {
            if (!popupItems.length) return '';
            const idx = popupIndex % popupItems.length;
            const item = popupItems[idx];
            return item.getAttribute('data-name')
                || (item.querySelector('.ttl')?.textContent.trim() || '');
        }

        /* Panel refs */
        const panel = document.getElementById('panel');
        const panelImg = panel.querySelector('.mosaic__panel-img img');
        const panelTitle = panel.querySelector('.mosaic__panel-title');
        const panelTxt = panel.querySelector('.mosaic__panel-body-inner .txt');
        const panelCTA = panel.querySelector('.mosaic__panel-cta');
        const panelClose = panel.querySelector('.mosaic__panel-close');

        let isOpen = false, isAnimating = false;
        let activeCard = null;

        function preload(src) {
            return new Promise((resolve) => {
                if (!src) { resolve(); return; }
                const im = new Image();
                im.onload = () => resolve();
                im.onerror = () => resolve();
                if ('decode' in im) { im.src = src; im.decode().then(resolve).catch(resolve); } else { im.src = src; }
            });
        }

        function fillPanelFromPopupElement(el) {
            const titleEl = el.querySelector('.ttl');
            const txtEl = el.querySelector('.txt');
            const imgEl = el.querySelector('.im-p');

            panelTitle.innerHTML = titleEl ? titleEl.innerHTML : '';

            panelTxt.innerHTML = '';
            if (txtEl) {
                const txtClone = txtEl.cloneNode(true);
                const linkInClone = txtClone.querySelector('.lnk');
                if (linkInClone) linkInClone.remove();
                panelTxt.appendChild(txtClone);
            }

            const linkEl = txtEl ? txtEl.querySelector('.lnk') : null;
            if (linkEl && linkEl.href) {
                panelCTA.href = linkEl.href;
                panelCTA.textContent = linkEl.textContent || linkEl.href;
                panelCTA.style.display = '';
            } else {
                panelCTA.removeAttribute('href');
                panelCTA.style.display = 'none';
            }

            if (imgEl && imgEl.src) {
                panelImg.src = imgEl.src;
                panelImg.alt = imgEl.alt || (titleEl ? titleEl.textContent.trim() : '');
            } else {
                panelImg.removeAttribute('src');
                panelImg.alt = '';
            }
        }

        /* ===== OPEN PANEL (нова логіка, контент з mosaic-popups, без фейкової картки) ===== */
        async function openPanelFromCard(card) {
            if (isOpen || isAnimating) return;
            if (!popupItems.length) return;

            isAnimating = true;
            root.classList.add('is-animating');

            if (activeCard) {
                activeCard.classList.remove('is-active');
            }
            activeCard = card;
            activeCard.classList.add('is-active');

            const popupEl = popupItems[popupIndex];
            popupIndex = (popupIndex + 1) % popupItems.length;

            fillPanelFromPopupElement(popupEl);

            panelImg.style.opacity = '0';
            await preload(panelImg.src);
            panelImg.style.opacity = '1';

            root.classList.add('is-panel');
            panel.setAttribute('aria-hidden', 'false');

            await waitTransition(panel, 'transform');

            isOpen = true;
            isAnimating = false;
            root.classList.remove('is-animating');
        }

        /* ===== Close panel ===== */
        function closePanel() {
            if (!isOpen && !isAnimating) return;

            isAnimating = true;
            root.classList.add('is-animating');
            root.classList.remove('is-panel');
            panel.setAttribute('aria-hidden', 'true');

            Promise.all([
                waitTransition(panel, 'transform'),
                waitTransition(view, 'transform')
            ]).finally(() => {
                if (activeCard) { activeCard.classList.remove('is-active'); activeCard = null; }
                isOpen = false; isAnimating = false;
                root.classList.remove('is-animating');
                void panel.offsetHeight;
            });
        }

        /* UI */
        if (!panelClose.dataset.bound) {
            panelClose.addEventListener('click', closePanel);
            panelClose.dataset.bound = '1';
        }
        window.addEventListener('keydown', e => { if (e.key === 'Escape') closePanel(); });

        /* ===== Drag/Zoom ===== */
        const cur = { x: 0, y: 0, s: ZOOMS[zoomIdx] },
            target = { x: 0, y: 0, s: ZOOMS[zoomIdx] },
            vel = { x: 0, y: 0 };

        function applyTransform() {
            plane.style.transform = `translate(-50%,-50%) translate3d(${cur.x}px,${cur.y}px,0)`;
            content.style.transform = `scale(${cur.s * introScale})`;
        }

        function getBounds() {
            const r = content.getBoundingClientRect(), vw = view.clientWidth, vh = view.clientHeight;
            const maxX = Math.max(0, (r.width - vw) / 2), maxY = Math.max(0, (r.height - vh) / 2);
            return { minX: -maxX, maxX: maxX, minY: -maxY, maxY: maxY };
        }
        function clampToBounds() {
            const b = getBounds();
            cur.x = clamp(cur.x, b.minX, b.maxX); cur.y = clamp(cur.y, b.minY, b.maxY);
            target.x = clamp(target.x, b.minX, b.maxX); target.y = clamp(target.y, b.minY, b.maxY);
        }
        function centerView() { cur.x = target.x = 0; cur.y = target.y = 0; }

        let dragging = false, downX = 0, downY = 0, startX = 0, startY = 0, lastX = 0, lastY = 0, downT = 0, downCard = null;

        view.addEventListener('pointerdown', e => {
            if (isIntro) return;
            if (root.classList.contains('is-panel') || root.classList.contains('is-animating')) return;
            dragging = true; view.setPointerCapture(e.pointerId);
            downX = lastX = e.clientX; downY = lastY = e.clientY; downT = performance.now();
            startX = cur.x; startY = cur.y; vel.x = vel.y = 0; hideName();
            downCard = e.target.closest('.card'); if (downCard && !content.contains(downCard)) downCard = null;
        });

        view.addEventListener('pointermove', e => {
            if (isIntro || root.classList.contains('is-panel') || root.classList.contains('is-animating')) { hideName(); return; }
            if (!dragging) {
                const card = e.target.closest('.card');
                if (card && content.contains(card)) {
                    const n = getNextPopupName();
                    if (n) showName(n, e.clientX, e.clientY); else hideName();
                } else hideName();
                return;
            }
            const dx = e.clientX - downX, dy = e.clientY - downY, b = getBounds();
            cur.x = clamp(startX + dx, b.minX, b.maxX); cur.y = clamp(startY + dy, b.minY, b.maxY);
            target.x = cur.x; target.y = cur.y;
            vel.x = e.clientX - lastX; vel.y = e.clientY - lastY; lastX = e.clientX; lastY = e.clientY;
            applyTransform();
        });

        function onPointerEnd(e) {
            if (!dragging) return;
            view.releasePointerCapture?.(e.pointerId);
            dragging = false;

            const tick = () => {
                if (dragging) return;
                vel.x *= INERTIA; vel.y *= INERTIA;
                target.x += vel.x; target.y += vel.y;
                clampToBounds();
                if (Math.abs(vel.x) > 0.1 || Math.abs(vel.y) > 0.1) requestAnimationFrame(tick);
            };
            requestAnimationFrame(tick);

            const dt = performance.now() - downT, dist = Math.hypot(e.clientX - downX, e.clientY - downY);
            if (dt <= TAP_TIME && dist <= TAP_DIST && downCard) openPanelFromCard(downCard);
            downCard = null;
        }
        view.addEventListener('pointerup', onPointerEnd);
        view.addEventListener('pointercancel', onPointerEnd);
        view.addEventListener('pointerleave', () => { if (!dragging) hideName(); });

        function zoomToIndexKeepCenter(nextIdx) {
            if (isIntro) return;
            const newIdx = clamp(nextIdx, 0, ZOOMS.length - 1), prevS = cur.s, nextS = ZOOMS[newIdx];
            if (nextS === prevS) return;
            const Cx = (0 - cur.x) / (prevS + EPS), Cy = (0 - cur.y) / (prevS + EPS);
            target.s = nextS; target.x = cur.x + (prevS - nextS) * Cx; target.y = cur.y + (prevS - nextS) * Cy;
            zoomIdx = newIdx; clampToBounds(); hideName();
            updateZoomButtons();
        }

        const ui = document.querySelector('.mosaic__ui');
        const btnZoomIn = ui.querySelector('[data-zoom="in"]');
        const btnZoomOut = ui.querySelector('[data-zoom="out"]');

        function updateZoomButtons() {
            btnZoomIn.classList.remove('is-disabled');
            btnZoomOut.classList.remove('is-disabled');
            if (isIntro) {
                btnZoomIn.classList.add('is-disabled');
                btnZoomOut.classList.add('is-disabled');
                return;
            }
            if (zoomIdx === 0) btnZoomIn.classList.add('is-disabled');
            if (zoomIdx === ZOOMS.length - 1) btnZoomOut.classList.add('is-disabled');
        }

        updateZoomButtons();
        ui?.addEventListener('click', e => {
            const b = e.target.closest('.btnk'); if (!b) return; e.stopPropagation();
            if (b.dataset.zoom === 'in') zoomToIndexKeepCenter(zoomIdx - 1);
            else if (b.dataset.zoom === 'out') zoomToIndexKeepCenter(zoomIdx + 1);
            else if (b.dataset.zoom === 'reset') {
                if (isIntro) return;
                zoomIdx = 0; target.s = ZOOMS[0]; centerView(); clampToBounds(); closePanel(); updateZoomButtons();
            }
        });

        /* Reveal on viewport enter */
        let cards = [];
        let frameCount = 0;

        function collectAllCards() {
            cards = Array.from(content.querySelectorAll('.card'));
            cards.forEach(c => c.classList.remove('_seen'));
        }
        function isIntersectingViewport(el, vp) {
            const r = el.getBoundingClientRect();
            return (
                r.right > vp.left + REVEAL_MARGIN_PX &&
                r.left < vp.right - REVEAL_MARGIN_PX &&
                r.bottom > vp.top + REVEAL_MARGIN_PX &&
                r.top < vp.bottom - REVEAL_MARGIN_PX
            );
        }
        function checkVisibility() {
            const vp = view.getBoundingClientRect();
            for (const card of cards) {
                if (REVEAL_ONCE && card.classList.contains('_seen')) continue;
                if (isIntersectingViewport(card, vp)) {
                    card.classList.add('_seen');
                } else if (!REVEAL_ONCE) {
                    card.classList.remove('_seen');
                }
            }
        }

        function rafLoop() {
            if (!dragging) {
                cur.x += (target.x - cur.x) * LERP_POS;
                cur.y += (target.y - cur.y) * LERP_POS;
                cur.s += (target.s - cur.s) * LERP_SCALE;
                if (Math.abs(target.x - cur.x) < EPS) cur.x = target.x;
                if (Math.abs(target.y - cur.y) < EPS) cur.y = target.y;
                if (Math.abs(target.s - cur.s) < EPS) cur.s = target.s;
                clampToBounds();
                applyTransform();
            }
            frameCount = (frameCount + 1) % VISIBILITY_CHECK_SKIP;
            if (frameCount === 0) checkVisibility();

            requestAnimationFrame(rafLoop);
        }

        /* init */
        const src = collectCards();
        buildGrid(src);
        collectAllCards();
        centerView();
        clampToBounds();
        applyTransform();
        checkVisibility();
        requestAnimationFrame(rafLoop);

        // resize
        window.addEventListener('resize', () => {
            clampToBounds(); applyTransform(); checkVisibility(); hideName();
        });

        // INTRO: click to enter
        btnOpen?.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            if (!isIntro) return;
            isIntro = false;
            animateIntroToOne(700);
            updateZoomButtons();
            preloadBlock.classList.add('hide');
        });
    })();
</script>


</body>
</html>